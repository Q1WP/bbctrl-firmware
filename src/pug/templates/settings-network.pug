//-/////////////////////////////////////////////////////////////////////////////
//-                                                                           //
//-               This file is part of the Buildbotics firmware.              //
//-                                                                           //
//-      Copyright (c) 2015 - 2021, Buildbotics LLC, All rights reserved.     //
//-                                                                           //
//-       This Source describes Open Hardware and is licensed under the       //
//-                               CERN-OHL-S v2.                              //
//-                                                                           //
//-       You may redistribute and modify this Source and make products       //
//-  using it under the terms of the CERN-OHL-S v2 (https:/cern.ch/cern-ohl). //
//-         This Source is distributed WITHOUT ANY EXPRESS OR IMPLIED         //
//-  WARRANTY, INCLUDING OF MERCHANTABILITY, SATISFACTORY QUALITY AND FITNESS //
//-   FOR A PARTICULAR PURPOSE. Please see the CERN-OHL-S v2 for applicable   //
//-                                conditions.                                //
//-                                                                           //
//-              Source location: https://github.com/buildbotics              //
//-                                                                           //
//-    As per CERN-OHL-S v2 section 4, should You produce hardware based on   //
//-  these sources, You must maintain the Source Location clearly visible on  //
//-  the external case of the CNC Controller or other product you make using  //
//-                                this Source.                               //
//-                                                                           //
//-              For more information, email info@buildbotics.com             //
//-                                                                           //
//-/////////////////////////////////////////////////////////////////////////////

script#settings-network-template(type="text/x-template")
  #settings-network
    h1 Network Configuration

    h2 Wifi Setup
    .pure-form.pure-form-aligned
      .pure-control-group
        label(for="wifi_country") Country
        input(name="wifi_country", v-model="wifi_country",
          title="Set Wifi regulatory region.")
        button.pure-button.pure-button-primary(@click="set_country") Set

    .wifi-device(v-for="net in state.network", v-if="net.type == 'wifi'")
      table.pure-table.pure-table-striped
        tr
          th Device
          td {{net.name}}
        tr
          th State
          td {{net.state}}
        tr
          th SSID
          td {{net.ssid}}
        tr
          th Address
          td: span(v-for="ip in net.ipv4") {{ip + ' '}}

        tr
          th Actions
          td.actions
            button.pure-button.pure-button-primary(@click="connect(net)")
              | #[.fa.fa-link] Connect
            button.pure-button.pure-button-primary(@click="hotspot(net)")
              | #[.fa.fa-wifi] Hotspot
            button.pure-button.pure-button-primary(@click="disconnect(net)")
              | #[.fa.fa-times] Disconnect

    p.
      WARNING: WiFi may be unreliable in an electrically noisy environment
      such as a machine shop.

    wifi-connect(v-ref:connect)
    wifi-hotspot(v-ref:hotspot)

    dialog(v-ref:wifi-password, header="Enter Wifi password", icon="question",
       width="400px",
       :buttons="['Cancel', {text: 'Ok', class: 'pure-button-primary'}]")

      div(slot="body")
        .pure-form.pure-form-aligned
          .pure-control-group
            label(for="wifi_pass") Password
            input.password(name="wifi_pass", v-model="wifi_pass")
          .pure-control-group

    h2 Hostname
    .pure-form.pure-form-aligned
      .pure-control-group
        label(for="hostname") Hostname
        input(name="hostname", v-model="hostname", @keyup.enter="set_hostname")
        button.pure-button.pure-button-primary(@click="set_hostname") Set

    message(:show.sync="hostnameSet")
      h3(slot="header") Hostname Set
      div(slot="body")
        p Hostname was successfuly set to #[strong {{hostname}}].
        p Rebooting to apply changes.
        p Redirecting to new hostname in {{redirectTimeout}} seconds.
      div(slot="footer")

    h2 Remote SSH User
    .pure-form.pure-form-aligned
      .pure-control-group
        label(for="username") Username
        input(name="username", v-model="username", @keyup.enter="set_username")
        button.pure-button.pure-button-primary(@click="set_username") Set

    .pure-form.pure-form-aligned
      .pure-control-group
        label(for="current") Current Password
        input.password(name="current", v-model="current")
      .pure-control-group
        label(for="pass1") New Password
        input.password(name="pass1", v-model="password")
      .pure-control-group
        label(for="pass2") New Password
        input.password(name="pass2", v-model="password2")
        button.pure-button.pure-button-primary(@click="set_password") Set
